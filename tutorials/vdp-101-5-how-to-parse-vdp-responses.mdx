---
title: "VDP 101 - 5. How to Parse Responses from SYNC Pipelines"
lang: "en-US"
draft: false
description: "In the `SYNC` mode, VDP will return post-processed inference results depending on the protocol (i.e., `HTTP/gRPC`) you use for tigger the pipeline. In this tutorial, we are going to use HTTP protocol as example to demonstrate how to understand and parse the responses fom VDP."
aiTask: "objectDetection"
sourceConnector: "HTTP"
destinationConnector: "HTTP"
publishedOn: "2023-01-30T17:26:00"
placeholderColor: "bg-instillYellow50"
themeImgSrc: "/tutorial-assets/vdp-101/cover-animation.gif"
themeImgThumbnailSrc: "/tutorial-assets/vdp-101/cover-static.png"
useCase: "Prototyping"
author: "Po-Yu Chen"
authorAvatarSrc: "/author-avatar/po-yu-chen.jpg"
authorGitHubUrl: "https://github.com/bryan107"
---

In the previous tutorial [VDP 101 - 4. How to Trigger a SYNC Pipeline?](/tutorials/vdp-101-4-how-to-trigger-a-sync-pipeline), you have learnt how to tigger and send data to pipeline, however, we haven't talk about how to process it. In the `SYNC` mode, VDP returns post-processed inference results according to the protocol (i.e., `HTTP/gRPC`) used for tiggering the pipeline. In this tutorial, we are going to use HTTP protocol as example to demonstrate how to parse the responses fom a `SYNC` pipeline.

## How to process pipeline responses

Let's go back to our code in `sync-http-base64.py`. After triggering a `SYNC` pipeline, the function will trun a response from the piprline you tiggered. 

```python
# Post HTTP request to the SYNC pipeline
resp = trigger_pipeline_multipart(pipeline_backend_url, pipeline_id, img_folder, img_names)

# Parse results from the SYNC pipeline
boxes_ltwh, categories, scores = parse_detection_response(resp)
```

Here, the pipeline responses our HTTP POST request with `resp: request.Response`, which is then passed to a user-defined parser `parse_detection_response(resp)` to extract object detection results. You can find corresponding parsers in all of our exampels as per ML task defined in VDP.

In the parsers, you can write code to convert the JSON object `resp` to Python object for easy access using the one line code below, where `resp.text` returns the content of the response, in unicode in Python 3.

```python
# Parse JSON into an Python object with attributes corresponding to dict keys.
r = json.loads(resp.text, object_hook=lambda d: SimpleNamespace(**d))
```


### Pipeline response in `SYNC` mode

To better understand what is in the `resp`, let's have a closer look on `resp.text`, the content of the `SYNC` mode reponse in JSON format:

```python
## This is the object returned in SYNC mode.
{
   "data_mapping_indices":[
      "01GPXG4P8MWZD4ZQMXD98CAEGG"
   ],
   "model_instance_outputs":[
      {
         "model_instance":"models/yolov7/instances/v1.0-cpu",
         "task":"TASK_DETECTION",
         "task_outputs":[
            {
               "index":"01GPXG4P8MWZD4ZQMXD98CAEGG",
               "detection":{
                  "objects":[
                     {
                        "category":"dog",
                        "score":0.9597808,
                        "bounding_box":{
                           "top":102,
                           "left":324,
                           "width":208,
                           "height":405
                        }
                     },
                     {
                        "category":"dog",
                        "score":0.92909366,
                        "bounding_box":{
                           "top":198,
                           "left":130,
                           "width":198,
                           "height":237
                        }
                     }
                  ]
               }
            }
         ]
      }
   ]
}
```

- `data_mapping_indices`: this is the pipeline trigger ID. You probably don't nees this ID in the `SYNC` mode as you receive reponses right after you trigger pipelines. However. in `ASYNC` and `PULL` modes, where pipelines do not return withs model inference results immediatly, users need this ID to locate corresponding resutls in the destination (e.g. database). We will talk about this later when we show how to create and use `ASYNC` pipelines in [VDP 101 - 7. Create, Trigger and Retrieve Data from ASYNC pipelines]
- `model_instance_outputs`: this is a list of outputs that users generated by tiggering a pipeline with a batch of data. Taking object detection as an example, if you pass three images to the pipeline, it will return with a list consisting of three outputs.

#### Model instance outputs `model_instance_outputs`

- `model_instance`: this is the model instance you defined when creating the pipeline.
- `task`: This is the task name defined by VDP model backend. You can identify the ML  task performed using it. The list of ML tasks currently defied by VDP can be found on [VDP standardised AI Tasks](/docs/core-concepts/ai-task) . For those unspecified tasks defined by users, VDP returns `TASK_UNSPECIFIED`. Note that when [importing customised models](https://www.instill.tech/docs/import-models/overview), users need to [define model card](/docs/prepare-models/model-card) corresponding to their ML tasks .
- `task_outputs`: list of outputs given diffent tasks.
    - `index`: This is the same as the `data_mapping_indices` received when triggering pipelines. Users can use it to match trigger queries and task outputs in `ASYNC` and `PULL` modes.
    - `detection`: this **key** changes as per ML task. Here, **detection** indicates this is an **object-detection** task. For further details of the avaible keys current defined in VDP, please read [VDP standardised AI Tasks](/docs/core-concepts/ai-task).

#### Task outputs `objects`
- `object`: this is a list of detection results. In VDP, we defiend different JSON objects, with which users can easily read/parse the model outputs, for popular AI tasks. 

:::info{type=info}
VDP currently defines task outputs for pupolar AI tasks. You can find details for each AI task in [VDP standardised AI Tasks](/docs/core-concepts/ai-task).
:::

### Pipeline responses in `ASYNC` and `PULL` modes

Unlike in `SYNC` mode, the pipelinse respones in `ASYNC`  and `PULL` modes are simple. Below is an JSON formatted reponse in `ASYNC`  and `PULL` modes.  As can be seen, `model_instance_outputs` is an **empty** list. Users only receive  `data_mapping_indices` wihch can be used to match the outputs in the desinations (e.g. databases or spreadsheets).

```python
## This is the object returned in ASYNC and PULL modes.
{  
	"data_mapping_indices": [  
		"01GDR4ZW7W4T2H2G8MK79Y49PG",  
		"01GDR4ZW7W4T2H2G8MK8AR1T2B"  
	],  
	"model_instance_outputs": []  
}
```


### Unspecificed Tasks

It is impossible for VDP to define all possible AI tasks and task inputs and outputs. VDP, therefore, allows users to deploy their own models even if the task has yet been standardised by VDP. These models will be classified as `Unspecified` tasks. VDP will
 - check the `config.pbtxt` [model configuration](https://docs.nvidia.com/deeplearning/triton-inference-server/user-guide/docs/user_guide/model_configuration.html) file when [deploying customized model on VDP] to extract the output names, datatypes and shapes of the model outputs,
 - and wrap these information along with the raw model output in a _standard_ format as the example below.

```python
## This is an example of the model outputs of undefiend tasks.
{  
	"unspecified": {  
		"raw_outputs": [  
			{  
				"data": [0.85, 0.1, 0.05],  
				"data_type": "FP32",  
				"name": "output_scores",  
				"shape": [3]  
			},  
			{  
				"data": ["dog", "cat", "rabbit"],  
				"data_type": "BYTES",  
				"name": "output_labels",  
				"shape": [3]  
			}  
		]  
	}  
}
```

:::info{type=info} 
> VDP exploits Triton Inference Server as model inference backbone. Don't worry about how to import models to VDP just yet. We will talk about this in [VDP 101 - Import Model to VDP]. 
:::

## AI Tasks currently defined by VDP

At the moment, VDP defines the task outputs for popular AI tasks:

-   _Image classification_ - classify images into predefined categories
-   _Object detection_ - detect and localise multiple objects in images
-   _Keypoint detection_ - detect and localise multiple keypoints of objects in images
-   _OCR (Optical Character Recognition)_ - detect and recognise text in images
-   _Instance segmentation_ - detect, localise and delineate multiple objects in images
-   *Sementic Segmentation -* recognize a collection of image pixels that form distinct categories.
-   The list is growing ... ðŸŒ±

A full list of tasks  can be found on [AI Task defined in VDP](https://www.instill.tech/docs/core-concepts/ai-task).

We have demonstrated how to use VDP step-by-step in `SYNC` mode. However, VDP also support other modes, including `ASYNC` and `PULL` mode. Before demonstrating how they works, let's have a closer look on their differences in our next tutorial â†’ [VDP 101 - 6. Pipeline Modes: SYNC, ASYNC and PULL](/tutorials/vdp-101-6-pipeline-modes).

<br/><br/>
**â†“â†“â†“ VDP 101 TUTORIALS â†“â†“â†“**
1. [Introduction to VDP](/tutorials/vdp-101-1-introduction)
2. [Install VDP on Your Local Machine](/tutorials/vdp-101-2-installation)
3. [Create Your First Pipeline on VDP](/tutorials/vdp-101-3-create-your-first-pipeline)
4. [How to Trigger a SYNC Pipeline](/tutorials/vdp-101-4-how-to-trigger-a-sync-pipeline)
5. [How to Parse Responses from SYNC Pipelines](/tutorials/vdp-101-5-how-to-parse-vdp-responses)
6. [Pipeline Modes: SYNC, ASYNC and PULL](/tutorials/vdp-101-6-pipeline-modes)