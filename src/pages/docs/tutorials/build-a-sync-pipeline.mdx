import { DocsLayout } from "@/components/docs";
export const meta = {
  title: "Build a SYNC pipeline",
  lang: "en-US",
  draft: false,
  description:
    "Build a SYNC pipeline with the open-source visual data ETL tool VDP https://github.com/instill-ai/vdp",
  date: "",
};

export default ({ children }) => (
  <DocsLayout meta={meta}>{children}</DocsLayout>
);

## Build via no-code Console

After onboarding, you will be redirected to the **Pipeline** page on the left sidebar, where you can build your first VDP pipeline by clicking **Create your first pipeline** and forever change the way you approach visual data processing workflow development.

**Add a HTTP Source**

In this tutorial you'll build your first **`SYNC`** pipeline and trigger the pipeline to process some images.
You can follow the tutorial via the **Pipeline** page or navigate to the **Source** page.

![Pipeline list page of the VDP Console](/docs-assets/tutorials/pipeline-list-empty.png)

A HTTP Source accepts HTTP requests with image payloads to be processed by a pipeline.
To set it up, click the **Source type** â–¾ drop-down and choose `HTTP`.

![Add a HTTP Source to create a pipeline in the VDP Console](/docs-assets/tutorials/add-a-source-http.png)

> Check our growing list of [Source connectors](/docs/source-connectors/overview).

**Import a model from GitHub**

To process images, here we import a model from our public GitHub repo [instill-ai/model-mobilenetv2](https://github.com/instill-ai/model-mobilenetv2).
To set it up, go to the **Model** page and click **Setup new model**

1. Fill an ID for your model, this will be the unique identifier of this model
2. Click the **Model type** â–¾ drop-down and choose `GitHub`
3. [Optional] Give a short description of your model in the **Description** field
4. Fill the GitHub repository URL `instill-ai/model-mobilenetv2` and click **Setup new model**

![Import a model from a GitHub repo via VDP Console](/docs-assets/tutorials/add-a-model.png)

VDP will fetch all the releases of the GitHub repository. Each release is converted into one model instance, using the release tag as the corresponding model instance id.

> Check our growing list of [model definitions](/docs/import-models/overview) to learn about how to import models from other platforms.

**Deploy a model instance of the imported model**

Once the model is imported, click the **Model instances** â–¾ drop-down, pick one model instance, and click **Deploy** to put it online.

![Deploy a model instance via VDP Console](/docs-assets/tutorials/deploy-a-model-instance.png)

**Add a HTTP Destination**

Just click **Next**. Since we are building a `SYNC` pipeline, the HTTP Destination is automatically paired with the HTTP source.

> The paired Sources and Destinations for pipelines in [`SYNC`](/docs/core-concepts/pipeline#sync-mode) mode:
>
> - HTTP Source â†’ HTTP Destination
> - gRPC Source â†’ gRPC Destination

![Add a HTTP Destination to create a pipeline in the VDP console](/docs-assets/tutorials/add-a-destination-http.png)

Almost done! Just give your pipeline a unique ID and an optional description, and click **Set up pipeline**.

![Set up a pipeline in the VDP Console](/docs-assets/tutorials/set-up-a-pipeline.png)

## Build via low-code

You can also build the pipeline by sending requests, thanks to the [API-first](/docs/core-concepts/overview#api) design.

<CH.Scrollycoding>

**Step 1: Add a HTTP source**

`http://localhost:8082` is the default URL of the VDP `connector-backend`.

```bash focus=1:11

curl -X POST http://localhost:8082/v1alpha/source-connectors -d '{
    "id": "source-http",
    "source_connector_definition": "source-connector-definitions/source-http",
    "connector": {
        "configuration": {}
    }
}'

curl -X POST http://localhost:8083/v1alpha/models -d '{
  "id": "mobilenetv2",
  "model_definition": "model-definitions/github",
  "configuration": {
    "repository": "instill-ai/model-mobilenetv2"
  }
}'

curl -X POST http://localhost:8083/v1alpha/models/mobilenetv2/instances/v1.0-cpu:deploy

curl -X POST http://localhost:8082/v1alpha/destination-connectors -d '{
  "id": "destination-http",
  "destination_connector_definition": "destination-connector-definitions/destination-http",
  "connector": {
      "configuration": {}
  }
}'

curl -X POST http://localhost:8081/v1alpha/pipelines -d '{
  "id": "classification",
  "recipe": {
    "source": "source-connectors/source-http",
    "model_instances": [
      "models/mobilenetv2/instances/v1.0-cpu"
    ],
    "destination": "destination-connectors/destination-http"
  }
}'

```

---

**Step 2: Import a model from GitHub**

`http://localhost:8083` is the default URL of the VDP `model-backend`.

```bash focus=13:22

```

---

**Step 3: Deploy a model instance**

Choose the model instance `v1.0-cpu` to deploy.

```bash focus=24:25

```

---

**Step 4: Add a HTTP Destination**

```bash focus=27:36

```

---

**Step 5: Create your first pipeline**

`http://localhost:8081` is the default URL of the VDP `pipeline-backend`.

```bash focus=38:51

```

</CH.Scrollycoding>

## Trigger your pipeline for the first time

> All `SYNC` pipelines are automatically activated.

Now that the `classification` pipeline is automatically activated, you can make a request to trigger the pipeline to process **multiple** images within a batch via remote image URLs, Base64 or multipart:

<CH.Code>

```bash cURL(url)
curl -X POST http://localhost:8081/v1alpha/pipelines/classification:trigger -d '{
  "inputs": [
    {
      "image_url": "https://artifacts.instill.tech/dog.jpg"
    },
    {
      "image_url": "https://images.pexels.com/photos/66898/elephant-cub-tsavo-kenya-66898.jpeg"
    }
  ]
}'
```

```bash cURL(base64)
curl -X POST http://localhost:8081/v1alpha/pipelines/classification:trigger -d '{
  "inputs": [
    {
      "image_base64": "/9j/4AAQSk...D/2Q=="
    },
    ...
  ]
}'
```

```bash cURL(multipart)
curl -X POST http://localhost:8081/v1alpha/pipelines/classification:trigger-multipart \
--form 'file=@"dog.jpg"' \
--form 'file=@"elephant.jpg"'
```

</CH.Code>

in which `http://localhost:8081` is the default URL of the VDP `pipeline-backend`.

A HTTP response will return

```json
{
  "output": {
    "classification_outputs": [
      {
        "category": "golden retriever",
        "score": 0.896806
      },
      {
        "category": "African elephant",
        "score": 0.861324
      }
    ]
  }
}
```

**ðŸ™Œ That's it!** You just built your first `SYNC` pipeline and triggered it to convert unstructured image data into structured, analysable insight.

## What's next?

By now, you should have a basic understanding of how VDP streamlines the end-to-end ETL pipelines for visual data.
This tutorial only shows the tip of what VDP is capable of and is just the beginning of your VDP journey.
Next, check out [Learn VDP](getting-started#learn-vdp).
If you have any problem at all, join our [Discord](https://discord.gg/sevxWsqpGh) to get [community support](getting-started#community-support).
