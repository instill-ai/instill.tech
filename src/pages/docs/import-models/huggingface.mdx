import { DocsLayout } from "@/components/docs";
export const meta = {
  title: "Import Models from Hugging Face",
  lang: "en-US",
  draft: false,
  description:
    "Learn about how to import models from Hugging Face into the open-source visual data ETL tool VDP https://github.com/instill-ai/vdp",
  date: "",
};

export default ({ children }) => (
  <DocsLayout meta={meta}>{children}</DocsLayout>
);

The `Hugging Face` model definition allows you to import models from a [Hugging Face](https://huggingface.co/models) repository.

## Supported model tasks

Currently, VDP supports importing models tagged with the following tasks

- âœ… [Image Classification](https://huggingface.co/models?pipeline_tag=image-classification&sort=downloads)

## Configuration

| Parameter   | Type   | Notes                                                                                                                                                                                                                         |
| :---------- | :----- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `repo_id`\* | string | A model repo name hosted on the [Hugging Face model hub](https://huggingface.co/models). Valid repo ids can be located at the root-level, or namespaced under a user or organization name, like `google/vit-base-patch16-224` |

## Getting started

### Requirements

- A public Hugging Face model repository that is labelled with `Image classification` task

### Setup guide

#### ðŸŽ¯ No-code console

Go to the model tab and click `Add new model`. Since a Hugging Face model has no version control, when the model is successfully imported, the model will has and only has one model instance tagged with `latest`.

1. Pick a name for your model, this will be the unique identifier of this model
2. Select `Hugging Face` from the drop-down list
3. Upload the model zip file and click Setup new model

![Add a Hugging Face model](/docs-assets/hf-add-model.png)

4. Once the model is imported, pick the `latest` model instance and click `Deploy`

![Deploy a model instance](/docs-assets/hf-deploy-model-instance.png)

Now go to the model tab, the corresponding model instance should be online.

![Hugging Face model list](/docs-assets/hf-model-list.png)

#### ðŸŽ¯ Low-code

1. Send a HTTP request to the VDP model backend to import a model from GCS bucket managed by ArtiVC:

```bash cURL
curl -X POST \
--header 'Content-Type: application/json' \
--data-raw '{
    "id": "vit-base-patch16-224",
    "model_definition": "model-definitions/huggingface",
    "configuration": {
        "repo_id": "google/vit-base-patch16-224"
    }
}' \
http://localhost:8083/v1alpha/models
```

2. Deploy the `latest` model instance

```bash cURL
curl -X POST http://localhost:8083/v1alpha/models/vit-base-patch16-224/instances/latest:deploy
```

3. Perform an inference to test the model

<CH.Code>

```bash remote
curl -X POST \
--header 'Content-Type: application/json' \
--data-raw '{
    "inputs": [
        {
            "image_url": "https://artifacts.instill.tech/dog.jpg"
        }
    ]
}' \
http://localhost:8083/v1alpha/models/vit-base-patch16-224/instances/latest:test
```

```bash base64
curl -X POST \
--header 'Content-Type: application/json' \
--data-raw '{
    "inputs": [
        {
            "image_base64": "/9j/4AAQSkZ...iiigD/2Q=="
        }
    ]
}' \
http://localhost:8083/v1alpha/models/vit-base-patch16-224/instances/latest:test
```

```bash multipart
curl -X POST \
--form 'file=@"dog.jpg"' \
http://localhost:8083/v1alpha/models/vit-base-patch16-224/instances/latest:test-multipart
```

</ CH.Code>

In which `http://localhost:8083` is the default URL of the model backend.
